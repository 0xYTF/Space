<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Model viewer</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
    <style>
      body {
        font-family: Monospace;
        background-color: #000;
        color: #fff;
        margin: 0px;
        overflow: hidden;
      }
      canvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>

    <script src="three.min.js"></script>
    <script src="pointerlock.js"></script>
	<script src="threejs/examples/js/loaders/MTLLoader.js"></script>
	<script src="threejs/examples/js/loaders/OBJMTLLoader.js"></script>

    <script>
      /* Three.js objects */
      var scene, camera, renderer, clock;

      /* Control */
      var controls;
      var moveForward = false, moveLeft = false;
      var moveBackward = false, moveRight = false;
      var moveUp = false, moveDown = false;
      var velocity = new THREE.Vector3();
      var moveSpeed = 50.0;

      /* Objects */
      var cube,floor;

      init();
      pointerLockSetup();
      render();

      function init(){
        clock = new THREE.Clock();

        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera( 45,
                                             window.innerWidth / window.innerHeight,
                                             0.1,
                                             1000 );

        controls = new THREE.PointerLockControls( camera );
        controls.getObject().translateX(0);
        controls.getObject().translateY(200);
        controls.getObject().translateZ(0);
        scene.add( controls.getObject() );

        renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        window.addEventListener( 'resize', onWindowResize, false );
        document.addEventListener( 'keydown', onKeyDown, false );
        document.addEventListener( 'keyup', onKeyUp, false );

        initObject();
        pointerLockSetup();
      }

      function initObject(){
        /* cube */
        var geometry = new THREE.BoxGeometry( 100, 100, 100);
        var material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });

        /*cube = new THREE.Mesh( geometry, material );
        cube.position.x = 1;
        cube.position.y = 0;
        cube.position.z = 0;
        cube.scale = 10;
        scene.add( cube );*/
		
		/*light*/
		var directionalLight1 = new THREE.DirectionalLight( 0xffeedd );
		directionalLight1.position.set( 100, 100, 0 ).normalize();
		var directionalLight2 = new THREE.DirectionalLight( 0xffeedd );
		directionalLight2.position.set( 100, 100, 0 ).normalize();
		var directionalLight3 = new THREE.DirectionalLight( 0xffeedd );
		directionalLight3.position.set( 0, 100, 100 ).normalize();

		scene.add( directionalLight1 );
		scene.add( directionalLight2 );
		scene.add( directionalLight3 );

		/*obj*/	
		var loader = new THREE.OBJMTLLoader();
		
		loader.load('threejs/examples/obj/test2/house.obj', 'threejs/examples/obj/test2/house.mtl', function(object) {
			object.position.x = 0;
			object.position.y = 0;
			object.position.z = -200;
      object.rotation.y = -1.5;
			scene.add(object);
		});
		
        /* floor */
        geometry = new THREE.PlaneGeometry( 2000, 2000, 100, 100 );
        geometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );
        for ( var i = 0, l = geometry.vertices.length; i < l; i ++ ) {
          var vertex = geometry.vertices[ i ];
          vertex.x += Math.random() * 20 - 10;
          vertex.y += Math.random() * 2;
          vertex.z += Math.random() * 20 - 10;
        }
        for ( var i = 0, l = geometry.faces.length; i < l; i ++ ) {
          var face = geometry.faces[ i ];
          face.vertexColors[ 0 ] = new THREE.Color().setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );
          face.vertexColors[ 1 ] = new THREE.Color().setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );
          face.vertexColors[ 2 ] = new THREE.Color().setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 );
        }
        material = new THREE.MeshBasicMaterial( { vertexColors: THREE.VertexColors } );

        floor = new THREE.Mesh( geometry, material );
        scene.add( floor );
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );
      }

      function onKeyDown ( event ) {
        switch ( event.keyCode ) {
          case 38: case 87: // up, w
            moveForward = true;
            moveBackward = false;
            break;
          case 37: case 65: // left, a
            moveLeft = true;
            moveRight = false;
            break;
          case 40: case 83: // down, s
            moveBackward = true;
            moveForward = false;
            break;
          case 39: case 68: // right, d
            moveRight = true;
            moveLeft = false;
            break;
          case 32: // space
            moveUp = true;
            moveDown = false;
            break;
          case 16: // shift
            moveDown = true;
            moveUp = false;
            break;
          case 107: // +
            moveSpeed *= 1.3;
            if(moveSpeed > 5000) moveSpeed = 5000;
            break;
          case 109: // -
            moveSpeed *= 0.7;
            if(moveSpeed < 100) moveSpeed = 100;
            break;
          }
        console.log(event.keyCode);
      };

      function onKeyUp( event ) {
        switch( event.keyCode ) {
          case 38: case 87: // up, w
            moveForward = false;
            break;
          case 37: case 65: // left, a
            moveLeft = false;
            break;
          case 40: case 83: // down, s
            moveBackward = false;
            break;
          case 39: case 68:// right, d
            moveRight = false;
            break;
          case 32: // space
            moveUp = false;
            break;
          case 16: // shift
            moveDown = false;
            break;
        }
      };

      function render(){
        requestAnimationFrame( render );

        var delta = clock.getDelta();
        //cube.rotation.y += 0.1;

        if(controls.enabled){
          if( moveForward ){
            velocity.z = -moveSpeed * delta;
          }else if( moveBackward ){
            velocity.z = moveSpeed * delta;
          }else{
            velocity.z = 0.0;
          }

          if( moveLeft ){
            velocity.x = -moveSpeed * delta;
          }else if( moveRight ){
            velocity.x = moveSpeed * delta;
          }else{
            velocity.x = 0.0;
          }

          if( moveUp ){
            velocity.y = moveSpeed * delta;
          }else if( moveDown ){
            velocity.y = -moveSpeed * delta;
          }else{
            velocity.y = 0.0;
          }
        }
        controls.getObject().translateX( velocity.x );
        controls.getObject().translateY( velocity.y );
        controls.getObject().translateZ( velocity.z );

        renderer.render( scene, camera );
      }
    </script>

  </body>
</html>

